<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Add a default marker</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
<script src="https://api.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.css" rel="stylesheet" />
<style>
  body { margin: 0; padding: 0; }
  #map { position: absolute; top: 0; bottom: 0; width: 100%; }
  .map-overlay{
position: absolute;
left: 0;
padding: 10px;

  }

</style>
</head>
<body>

<div id="map"></div>
<div class="map-overlay top">
  <button style="font-size: 2em;" onclick="showStation()">
    Show stations</button>
</div>

<script>

  mapboxgl.accessToken = "pk.eyJ1IjoidHNjaGFuenZlcmEiLCJhIjoiY2xwMmZ0eHc4MHc1YzJpcWtwbmJ0eGJpNCJ9.3Q1C6GPaLmZsOFh6eD4rDA"

  var map = new mapboxgl.Map({
    container: "map",
    style: "mapbox://styles/mapbox/streets-v11",
    center: [ 7.440213,46.948104],
    zoom: 14
  });
  function createMarker(coord){
    new mapboxgl.Marker()
      .setLngLat(coord)
      .addTo(map);
  }


  function getCoords(station){
    const coord= station.coordinate;
    return [coord.y,coord.x]

  }

  


  function getStations(place){
    const promise = fetch("https://transport.opendata.ch/v1/locations?query="+ place)
    return promise.then(r=>r.text())
                   .then(text=>JSON.parse(text))
                   .then(json=>json.stations)
                   .then(stations=>stations.map(getCoords))
  }

  

  var counter= 0;
  function showStation(){
    getStations("Bern")
    .then(coords=>coords.forEach(createMarker))
  }



</script>
</body>
</html>